
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Creating Choropleth Maps with Folium &#8212; Python for Nonprofits</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Mapping/choropleth_maps_with_folium';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="folium_choropleth_map_functions.py" href="../Book_Specific_Materials/folium_choropleth_map_functions_py_nb.html" />
    <link rel="prev" title="plotly_choropleth_map_functions.py" href="../Book_Specific_Materials/plotly_choropleth_map_functions_py_nb.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../front_matter_for_book.html">
  
  
  
  
  
  
    <p class="title logo__title">Python for Nonprofits</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../front_matter_for_book.html">
                    Wecome to Python for Nonprofits!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Introduction/introduction.html">An Introduction to Python for Nonprofits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Introduction/the_case_for_python_at_nonprofits.html">The Case for Using Python at Nonprofits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Book_Specific_Materials/getting_started_for_book.html">Getting Started</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Importing and Prepping Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Data_Retrieval/data_retrieval.html">Data Retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data_Prep/data_prep.html">Data Prep</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analyzing Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Descriptive_Stats/descriptive_stats.html">Descriptive Stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Descriptive_Stats/descriptive_stats_part_2.html">Descriptive Stats: Part 2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Census_Data_Imports/census_data_imports.html">Census Data Imports</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/census_import_scripts_py_nb.html">census_import_scripts.py</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualizing Data</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Graphing/graphing.html">Creating Interactive and Static Charts with Plotly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Graphing/pivot_and_graph_functions.html">Pivot and Graph Functions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="choropleth_maps.html">Mapping Census Data using Plotly</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/plotly_choropleth_map_functions_py_nb.html">plotly_choropleth_map_functions.py</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">Creating Choropleth Maps with Folium</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/folium_choropleth_map_functions_py_nb.html">folium_choropleth_map_functions.py</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regressions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Regressions/regression_analyses.html">Regression Analyses</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Publishing Analyses Online</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Static_Sites/simple_static_site.html">Creating a Simple Static Webpage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Updating_Online_Spreadsheets/updating_online_spreadsheets.html">Updating Online Spreadsheets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/weather_import_py_nb.html">weather_import.py</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Online_Visualizations/Simple_App_Without_Login/readme.html">Simple Dash App Without Login</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/Simple_App_Without_Login_py_nb.html">Source code for Simple App Without Login</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Online_Visualizations/PFN_Dash_App_Demo/readme.html">PFN Dash App Demo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Book_Specific_Materials/PFN_Dash_App_Demo_py_nb.html">Source code for PFN Dash App Demo</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Appendix/nvcu_db_gen.html">NVCU Database Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Book_Specific_Materials/helper_funcs_py_nb.html">helper_funcs.py</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Mapping/choropleth_maps_with_folium.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating Choropleth Maps with Folium</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-our-net-migration-data">Gathering our net migration data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-total-net-migration-across-all-years-within-the-dataset">Calculating total net migration across all years within the dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-percentile-data-to-each-dataset">Adding percentile data to each dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-county-and-state-boundaries">Importing county and state boundaries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-shape-and-demographic-data-tables-together">Merging shape and demographic data tables together</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-choropleth-map-with-interactive-tooltips">Creating a choropleth map with interactive tooltips</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-bin-ranges">Creating our bin ranges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-in-tooltips">Adding in tooltips</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-a-screenshot-of-this-map">Saving a screenshot of this map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-drawback-of-the-choropleth-mapping-approach-shown-above">The drawback of the choropleth mapping approach shown above</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-more-efficient-version-of-this-map">Creating a more efficient version of this map</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-this-color-range-to-initialize-our-colormap">Using this color range to initialize our colormap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-tooltips-and-choropleth-map-simultaneously-via-folium-geojson">Creating our tooltips and choropleth map simultaneously via folium.GeoJson</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-this-second-mapping-approach-into-a-function">Converting this second mapping approach into a function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calling-this-function-separately-for-html-and-png-maps">Calling this function separately for HTML and PNG maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-these-functions-to-create-html-and-png-versions-of-our-net-migration-by-county-map-with-optimized-zoom-levels">Applying these functions to create HTML and PNG versions of our net migration by county map with optimized zoom levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calling-create-map-and-screenshot-again-to-create-state-level-net-migration-maps-in-html-and-png-form">Calling create_map_and_screenshot() again to create state-level net migration maps in HTML and PNG form</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="creating-choropleth-maps-with-folium">
<h1>Creating Choropleth Maps with Folium<a class="headerlink" href="#creating-choropleth-maps-with-folium" title="Link to this heading">#</a></h1>
<p>By Kenneth Burchfiel</p>
<p>Released under the MIT license</p>
<p><em>Note: If the Plotly library meets your mapping needs, feel free to skip this section and focus on choropleth_maps.ipynb instead. If you’re curious about an alternative mapping tool, though, read on!</em></p>
<p><em>I had originally planned to base PFN’s mapping code on Folium; however, I then realized that Plotly had some significant advantages for my own mapping work, so I went ahead and created a Plotly-based mapping notebook also. Both libraries are fantastic tools, and you may very well find that Folium is a better fit for your projects.</em></p>
<p><em>Also, you can find Google Sites-hosted copies of two interactive maps shown within this notebook via the following links:</em></p>
<p><em><a class="reference external" href="https://sites.google.com/view/pfn2-choropleth-maps/net-migration-by-county?authuser=0">Link to Net Migration by County map</a></em></p>
<p><em><a class="reference external" href="https://sites.google.com/view/pfn2-choropleth-maps/net-migration-by-state?authuser=0">Link to Net Migration by State map</a></em></p>
<p>This code shows how to use Python’s Folium library to generate choropleth maps of county- and state-level net domestic migration rates (which I’ll often refer to as ‘domestic migration’ or ‘net migration’ to save space). The first part of the code demonstrates how to use Folium’s built-in <code class="docutils literal notranslate"><span class="pre">folium.choropleth()</span></code> function; the second part demonstrates how to create a more efficient version of this same choropleth map using a custom function.</p>
<p><strong>A quick overview of domestic net migration</strong></p>
<p>Domestic net migration data comprises movements from one part of a country to another. For instance, if someone moves from Fairfax County, VA to Harris County, TX, Fairfax County’s net migration totals for the year would decrease by 1 whereas Harris County’s would increase by 1. Note that international migration, births, and deaths do <em>not</em> factor into net migration totals. By focusing only on movements within the US, this data offers an intriguing look into which parts of a country are attracting pre-existing residents–and which are failing to attract (or retain) them.</p>
<p>Let’s say that NVCU’s seniors want to know which parts of the country are particularly popular areas to which to move. In order to help answer this question, you’ve decided to create county-level net domestic migration maps. (The seniors will need to interpret this analysis with caution: for instance, they might not necessarily want to move to a place whose high net domestic migration rates are driven by retirees. Then again, that might be the <em>perfect</em> destination for a college grad who loves playing bridge and pickleball!)</p>
<p>Our analyses within this notebook will use net migration <em>rates</em> (i.e. net migration totals divided by population totals) rather than nominal net migration counts because the former measure better reflects individuals’ likelihood of moving to or from a given region. For instance, a county with 1 million residents and a positive net migration total of 2,000 would be a less ‘hot’ destination than a one with 100,000 residents and a net migration total of 1,000. The latter county’s total net migration is 50% that of the former’s, but its rate (1000 / 100,000, or 1%) is five times that of the larger county’s (2,000 / 1,000,000, or 0.2%), thus indicating a greater interest in moving there relative to its size.</p>
<p>Determining whether to display HTML and PNG maps within the notebook’s output:
(These maps can also be accessed within the ‘maps’ and ‘map_screenshots’ folders.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;../Appendix&#39;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">helper_funcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_notebook</span><span class="p">,</span> <span class="n">wadi</span>
<span class="n">display_type</span> <span class="o">=</span> <span class="n">config_notebook</span><span class="p">(</span><span class="n">display_max_columns</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Importing the libraries we’ll need for this script:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">program_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span> <span class="c1"># Source: StacKOverflow user &#39;zach&#39; at</span>
<span class="c1"># https://stackoverflow.com/a/11855133/13097194</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">branca.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">color_brewer</span>
<span class="c1"># color_brewer source code: </span>
<span class="c1"># https://github.com/python-visualization/branca/blob/main/branca/</span>
<span class="c1"># utilities.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span> <span class="c1"># selenium will be used to generate</span>
<span class="c1"># screenshots of our HTML-based maps. I found that selenium didn&#39;t work </span>
<span class="c1"># correctly within JupyterLab Desktop right after the library was </span>
<span class="c1"># installed; however, when I restarted my kernel and then restarted </span>
<span class="c1"># JupyterLab Desktop, it ended up working fine. (Restarting JupyterLab </span>
<span class="c1"># Desktop alone probably would have resolved this issue.)</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">branca.colormap</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="c1"># From https://python-visualization.github.io/folium/latest/</span>
<span class="c1"># advanced_guide/colormaps.html#StepColormap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">branca.colormap</span><span class="w"> </span><span class="kn">import</span> <span class="n">StepColormap</span> <span class="c1"># From Folium&#39;s features.py</span>
<span class="c1"># source code: </span>
<span class="c1"># https://github.com/python-visualization/folium/blob/main/</span>
<span class="c1"># folium/features.py</span>
</pre></div>
</div>
</div>
</div>
<section id="gathering-our-net-migration-data">
<h2>Gathering our net migration data<a class="headerlink" href="#gathering-our-net-migration-data" title="Link to this heading">#</a></h2>
<p>The ‘co-est2023-alldata.csv’ file, located within the same folder as this code, contains net migration data for US states and counties during the 2020-2023 time period. I found this data on the Census site’s <a class="reference external" href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-counties-total.html"><strong>County Population Totals and Components of Change: 2020-2023</strong></a> page. The dataset is listed under a relatively long title:</p>
<p><em>Annual Resident Population Estimates, Estimated Components of Resident Population Change, and Rates of the Components of Resident Population Change for States and Counties: April 1, 2020 to July 1, 2023 (CO-EST2023-alldata)</em></p>
<p>Definitions of each column within this file can be found within CO-EST2023-ALLDATA.pdf, which I also downloaded from the aforementioned website to this section’s folder.</p>
<p>You may want to check the Census website to see whether a later version of the file exists. As long as that newer file matches the format of ‘co-est2023-alldata.csv’, the rest of this code should still work correctly (provided that you update the following cell with the new filename).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;co-est2023-alldata.csv&#39;</span><span class="p">,</span> 
    <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;latin_1&#39;</span><span class="p">)</span> <span class="c1"># nm = &#39;net migration. </span>
<span class="c1"># This dataset contains other population data as well, but we&#39;ll mostly </span>
<span class="c1"># use its net migration totals.</span>
<span class="c1"># I needed to add in &#39;encoding = latin_1&#39; because </span>
<span class="c1"># the default encoding setting produced an error message.</span>
<span class="n">df_nm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>RNETMIG2022</th>
      <th>RNETMIG2023</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>6.486978</td>
      <td>7.096186</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>8.896064</td>
      <td>8.745044</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>29.985390</td>
      <td>28.377843</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>9.708935</td>
      <td>-1.298570</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-13.620476</td>
      <td>-3.101199</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 67 columns</p>
</div></div></div>
</div>
<section id="calculating-total-net-migration-across-all-years-within-the-dataset">
<h3>Calculating total net migration across all years within the dataset<a class="headerlink" href="#calculating-total-net-migration-across-all-years-within-the-dataset" title="Link to this heading">#</a></h3>
<p>As specified within the ALLDATA.pdf file, ‘DOMESTICMIG’ columns show net domestic migration values. Note that there’s a column for each year, and that all but one of these years begins on July 1 and ends on June 30. (The one exception is DOMESTICMIG2020, which uses a date range of 2020-04-01 to 2020-06-30).</p>
<p>For our choropleth map, we’ll look into net migration across the entire date range in the dataset (e.g. 2020-04-01 to the latest date available). As of 2024-05-24, we had data up to June 30, 2023, but the Census will probably provide data for additional years in the future.</p>
<p>Therefore, rather than explicitly specifying the years available within our code, we’ll instead add in Python code that determines the first and last years with net migration data. This <em>should</em> make it easier to update the code with a later dataset. (I say ‘should’ because, if the Census Bureau decides to change the column names within this dataset, we’ll need to rewrite the code anyway to handle those new columns.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determining all columns with nominal net migration data:</span>
<span class="c1"># (These columns all begin with DOMESTICMIG. There are also </span>
<span class="c1"># RDOMESTICMIG columns that show migration rates, but checking</span>
<span class="c1"># to see whether the *first* 11 characters contain &#39;DOMESTICMIG&#39;</span>
<span class="c1"># will exclude them. </span>
<span class="n">nm_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df_nm</span><span class="o">.</span><span class="n">columns</span> 
           <span class="k">if</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DOMESTICMIG&#39;</span><span class="p">]</span>
<span class="n">nm_cols</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># This ensures that the first and last columns in our </span>
<span class="c1"># list will show the earliest and latest years with net migration data,</span>
<span class="c1"># respectively.</span>
<span class="n">nm_cols</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;DOMESTICMIG2020&#39;, &#39;DOMESTICMIG2021&#39;, &#39;DOMESTICMIG2022&#39;, &#39;DOMESTICMIG2023&#39;]
</pre></div>
</div>
</div>
</div>
<p>Using our list of net migration columns to identify the earliest and latest years with net migration data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_nm_year</span> <span class="o">=</span> <span class="n">nm_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="c1"># -4: retrieves the final 4 characters</span>
<span class="c1"># within the column names (i.e. the year).</span>
<span class="n">last_nm_year</span> <span class="o">=</span> <span class="n">nm_cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
<span class="n">first_nm_year</span><span class="p">,</span> <span class="n">last_nm_year</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;2020&#39;, &#39;2023&#39;)
</pre></div>
</div>
</div>
</div>
<p>We can now use our column list and starting/ending years to create a column that sums up all domestic net migration values for all years present in the dataset. In addition, we’ll create a column that divides this sum by the population values in the first year of the dataset, thus allowing us to determine total net migration rates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adding all of the net migration values within nm_cols together:</span>
<span class="n">df_nm</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1"> Total Domestic </span><span class="se">\</span>
<span class="s1">Net Migration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_nm</span><span class="p">[</span><span class="n">nm_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Creating our domestic migration rate column:</span>
<span class="c1"># Saving this column name to a variable will make it easier to incorporate</span>
<span class="c1"># into other lines of code that use it.</span>
<span class="n">total_nm_rate_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1"> Total Domestic Net </span><span class="se">\</span>
<span class="s1">Migration as % of </span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1"> Population&#39;</span>

<span class="n">df_nm</span><span class="p">[</span><span class="n">total_nm_rate_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">100</span> <span class="o">*</span> <span class="n">df_nm</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">Total Domestic Net Migration&#39;</span><span class="p">]</span> <span class="o">/</span>
    <span class="n">df_nm</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ESTIMATESBASE</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span> <span class="c1"># Multiplying by 100 converts</span>
    <span class="c1"># the proportions into percentages</span>
<span class="c1"># As of 2024-05-24, the starting population selected by this code will be</span>
<span class="c1"># ESTIMATEBASE2020, which shows population estimates on 2020-04-01.</span>
<span class="c1"># There&#39;s also a POPESTIMATE2020 column, but its reference date is </span>
<span class="c1"># 2020-07-01. Since we&#39;re incorporating net migration data from 2020-04-01</span>
<span class="c1"># to 2020-07-01 into our analysis, the ESTIMATEBASE2020 column is the best</span>
<span class="c1"># set of population data to use.</span>

<span class="n">df_nm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>96538</td>
      <td>1.921424</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>1340</td>
      <td>2.278563</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>22425</td>
      <td>9.675624</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-307</td>
      <td>-1.216854</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-219</td>
      <td>-0.982019</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 69 columns</p>
</div></div></div>
</div>
<p>This table contains both county-specific and statewide data. Rows with COUNTY values of 0 represent statewide totals; therefore, we can create county- and state-level versions of this dataset by selecting rows that have non-zero and zero COUNTY values, respectively.</p>
<p>(We could also have used SUMLEV column values (50 for counties and 40 for states) as a basis for this split.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_county</span> <span class="o">=</span> <span class="n">df_nm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COUNTY != 0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_nm_county</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>1340</td>
      <td>2.278563</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>22425</td>
      <td>9.675624</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-307</td>
      <td>-1.216854</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-219</td>
      <td>-0.982019</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>1109</td>
      <td>1.875528</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 69 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_state</span> <span class="o">=</span> <span class="n">df_nm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COUNTY == 0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_nm_state</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>96538</td>
      <td>1.921424</td>
    </tr>
    <tr>
      <th>68</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-17356</td>
      <td>-2.366596</td>
    </tr>
    <tr>
      <th>99</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>218247</td>
      <td>3.049036</td>
    </tr>
    <tr>
      <th>115</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>57290</td>
      <td>1.902381</td>
    </tr>
    <tr>
      <th>191</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-1197950</td>
      <td>-3.029854</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 69 columns</p>
</div></div></div>
</div>
</section>
<section id="adding-percentile-data-to-each-dataset">
<h3>Adding percentile data to each dataset<a class="headerlink" href="#adding-percentile-data-to-each-dataset" title="Link to this heading">#</a></h3>
<p>In order to more easily compare net migration rates, we’ll now create a column that calculates the percentile corresponding to each rate.</p>
<p>(Applying this code to each dataset separately prevents state values from influencing county percentiles and vice versa.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">percentile_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">Domestic Net Migration Percentile&#39;</span>
<span class="n">percentile_col</span>

<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">df_nm_state</span><span class="p">,</span> <span class="n">df_nm_county</span><span class="p">]:</span> <span class="c1"># Using a for loop allows us to </span>
    <span class="c1"># apply the same code to our state and county DataFrames.</span>
    <span class="n">df</span><span class="p">[</span><span class="n">percentile_col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">total_nm_rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># See https://pandas.pydata.org/pandas-docs/stable/reference/api/</span>
    <span class="c1"># pandas.DataFrame.rank.html</span>

<span class="n">df_nm_county</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>2.278563</td>
      <td>68.225191</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>9.675624</td>
      <td>96.660305</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-1.216854</td>
      <td>22.073791</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>-0.982019</td>
      <td>24.809160</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>1.875528</td>
      <td>64.408397</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
<p>Let’s now take a look at the states with the highest and lowest net migration rates in our dataset. (You’ll need to scroll to the right to see the actual rates and percentiles.)</p>
<p>Highest rates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_state</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">percentile_col</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>565</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>5.671907</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>2358</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>4.846318</td>
      <td>98.039216</td>
    </tr>
    <tr>
      <th>1626</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>4.467998</td>
      <td>96.078431</td>
    </tr>
    <tr>
      <th>325</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>3.885869</td>
      <td>94.117647</td>
    </tr>
    <tr>
      <th>331</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>3.801438</td>
      <td>92.156863</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
<p>Lowest rates:</p>
<p><em>Note that, while the percentile for the highest state is 100, the lowest state’s percentile is 1.96 (100 / 51). I believe this is because Pandas calculated each entry’s percentile as the percentage of entries that are <em>equal to</em> or lower than all entries within the dataset. Therefore, since the lowest entry’s percentile is at least equal to itself, its percentile won’t be 0. This isn’t the only way to define percentiles, but it works well enough for our purposes.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_state</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">percentile_col</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1862</th>
      <td>40</td>
      <td>1</td>
      <td>...</td>
      <td>-4.369181</td>
      <td>1.960784</td>
    </tr>
    <tr>
      <th>329</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>-4.126181</td>
      <td>3.921569</td>
    </tr>
    <tr>
      <th>191</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-3.029854</td>
      <td>5.882353</td>
    </tr>
    <tr>
      <th>559</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-2.863378</td>
      <td>7.843137</td>
    </tr>
    <tr>
      <th>610</th>
      <td>40</td>
      <td>2</td>
      <td>...</td>
      <td>-2.844218</td>
      <td>9.803922</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
<p>We’ll now perform the same analysis for counties. However, in order to prevent unusual migration patterns within smaller counties from skewing our results, we’ll limit our results to counties that had at least 100,000 residents in 2020.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_nm_county</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="err">\</span>
<span class="w">    </span><span class="s1">&#39;POPESTIMATE2020 &gt;= 100000&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> counties out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_nm_county</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">had over 100,000 residents in 2020.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>605 counties out of 3144 had over 100,000 residents in 2020.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_county</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;POPESTIMATE2020 &gt;= 100000&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">percentile_col</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2697</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>25.596840</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>391</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>21.892944</td>
      <td>99.968193</td>
    </tr>
    <tr>
      <th>2767</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>20.253329</td>
      <td>99.936387</td>
    </tr>
    <tr>
      <th>2614</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>20.129665</td>
      <td>99.904580</td>
    </tr>
    <tr>
      <th>1935</th>
      <td>50</td>
      <td>3</td>
      <td>...</td>
      <td>19.072387</td>
      <td>99.840967</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_county</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;POPESTIMATE2020 &gt;= 100000&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">percentile_col</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1865</th>
      <td>50</td>
      <td>1</td>
      <td>...</td>
      <td>-10.586540</td>
      <td>0.445293</td>
    </tr>
    <tr>
      <th>1886</th>
      <td>50</td>
      <td>1</td>
      <td>...</td>
      <td>-8.905899</td>
      <td>0.604326</td>
    </tr>
    <tr>
      <th>229</th>
      <td>50</td>
      <td>4</td>
      <td>...</td>
      <td>-8.816523</td>
      <td>0.636132</td>
    </tr>
    <tr>
      <th>1903</th>
      <td>50</td>
      <td>1</td>
      <td>...</td>
      <td>-8.672521</td>
      <td>0.763359</td>
    </tr>
    <tr>
      <th>1253</th>
      <td>50</td>
      <td>1</td>
      <td>...</td>
      <td>-7.983719</td>
      <td>0.954198</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="importing-county-and-state-boundaries">
<h2>Importing county and state boundaries<a class="headerlink" href="#importing-county-and-state-boundaries" title="Link to this heading">#</a></h2>
<p>(See choropleth_maps.ipynb for more information on this step.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reading in our shapefile data:</span>
<span class="n">gdf_counties</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span>
    <span class="s1">&#39;shapefiles/cb_2023_us_county_500k/cb_2023_us_county_500k.shp&#39;</span><span class="p">)</span>
<span class="c1"># This abbreviation of &#39;GeoDataFrame&#39; as &#39;gdf&#39; derives from</span>
<span class="c1"># https://geopandas.org/en/stable/docs/reference/api/geopandas.</span>
<span class="c1"># GeoDataFrame.html</span>

<span class="c1"># The current versions of the county outlines would result in a very large </span>
<span class="c1"># output file (e.g. around 42 MB).</span>
<span class="c1"># We can reduce this file size (and the time required to generate and </span>
<span class="c1"># save the map) by simplifying the county outlines.</span>
<span class="c1"># I found a tolerance argument of 0.005 to work well for this project,</span>
<span class="c1"># but feel free to experiment with larger or smaller values.</span>
<span class="n">gdf_counties</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_counties</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="c1"># Source: https://geopandas.org/en/stable/docs/reference/api/geopandas.</span>
<span class="c1"># GeoSeries.simplify.html</span>

<span class="c1"># Adding a column that combines County and State names: (This will help </span>
<span class="c1"># prevent the code from confusing counties in different states with </span>
<span class="c1"># the same name.)</span>
<span class="n">gdf_counties</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;County/State&#39;</span><span class="p">,</span> <span class="n">gdf_counties</span><span class="p">[</span><span class="s1">&#39;NAMELSAD&#39;</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">gdf_counties</span><span class="p">[</span><span class="s1">&#39;STUSPS&#39;</span><span class="p">])</span>
<span class="n">gdf_counties</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County/State</th>
      <th>STATEFP</th>
      <th>...</th>
      <th>AWATER</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baldwin County, AL</td>
      <td>01</td>
      <td>...</td>
      <td>1132887203</td>
      <td>POLYGON ((-88.02858 30.22676, -87.96685 30.235...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Houston County, AL</td>
      <td>01</td>
      <td>...</td>
      <td>4795415</td>
      <td>POLYGON ((-85.71209 31.19727, -85.69231 31.210...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Barbour County, AL</td>
      <td>01</td>
      <td>...</td>
      <td>50523213</td>
      <td>POLYGON ((-85.74803 31.61918, -85.73117 31.629...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sumter County, AL</td>
      <td>01</td>
      <td>...</td>
      <td>24634880</td>
      <td>POLYGON ((-88.42145 32.30868, -88.34043 32.991...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Miller County, AR</td>
      <td>05</td>
      <td>...</td>
      <td>36848741</td>
      <td>POLYGON ((-94.04343 33.55158, -94.00037 33.564...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 14 columns</p>
</div></div></div>
</div>
<p>Ensuring that no states have two or more counties with the same name (which would likely cause all sorts of headaches):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_counties</span><span class="p">[</span><span class="s1">&#39;County/State&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(0)
</pre></div>
</div>
</div>
</div>
<p>Since there are far fewer states than there are counties, our state dataset won’t require as much processing time as our county dataset. In addition, maps that show only data at the state level will generally take up less storage space. One disadvantage of these maps, though, is that the state-level data will hide interesting variations in net migration data at the county level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_states</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span>
    <span class="s1">&#39;shapefiles/cb_2023_us_state_500k/cb_2023_us_state_500k.shp&#39;</span><span class="p">)</span>
<span class="n">gdf_states</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_states</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">gdf_states</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>STATENS</th>
      <th>...</th>
      <th>AWATER</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>35</td>
      <td>00897535</td>
      <td>...</td>
      <td>726463919</td>
      <td>POLYGON ((-109.05004 31.3325, -109.04522 36.99...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>46</td>
      <td>01785534</td>
      <td>...</td>
      <td>3387709166</td>
      <td>POLYGON ((-104.05788 44.9976, -104.03969 44.99...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>06</td>
      <td>01779778</td>
      <td>...</td>
      <td>20291770234</td>
      <td>MULTIPOLYGON (((-118.60442 33.47855, -118.5386...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>21</td>
      <td>01779786</td>
      <td>...</td>
      <td>2384223544</td>
      <td>MULTIPOLYGON (((-89.41728 36.49901, -89.37637 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01</td>
      <td>01779775</td>
      <td>...</td>
      <td>4582326383</td>
      <td>MULTIPOLYGON (((-88.05338 30.50699, -88.03867 ...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 10 columns</p>
</div></div></div>
</div>
<section id="merging-shape-and-demographic-data-tables-together">
<h3>Merging shape and demographic data tables together<a class="headerlink" href="#merging-shape-and-demographic-data-tables-together" title="Link to this heading">#</a></h3>
<p>Creating a table that stores both demographic and state data may make graphing tasks easier. Therefore, we’ll now merge gdf_counties and df_nm_county together using their state and county ID columns as keys. In order to make this process easier, we’ll rename gdf_counties’ copies of these ID fields and change their values to integers in the following cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Renaming the ID fields within gdf_counties so that they match the </span>
<span class="c1"># names of their corresponding fields within df_nm_county:</span>
<span class="n">gdf_counties</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;STATEFP&#39;</span><span class="p">:</span><span class="s1">&#39;STATE&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;COUNTYFP&#39;</span><span class="p">:</span><span class="s1">&#39;COUNTY&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># df_nm_county&#39;s ID fields are stored as integers, so in order to</span>
<span class="c1"># prevent the merge from failing to match integer- and string-formatted </span>
<span class="c1"># numbers we&#39;ll convert these to integers as well: </span>

<span class="c1"># (The fact that the IDs have leading 0s is a dead giveaway </span>
<span class="c1"># that they&#39;re currently</span>
<span class="c1"># stored as strings, though you could also check the output of </span>
<span class="c1"># gdf_counties.dtypes to confirm this.)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;COUNTY&#39;</span><span class="p">]:</span>
    <span class="n">gdf_counties</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_counties</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>  
    
<span class="n">gdf_counties</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County/State</th>
      <th>STATE</th>
      <th>...</th>
      <th>AWATER</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baldwin County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>1132887203</td>
      <td>POLYGON ((-88.02858 30.22676, -87.96685 30.235...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Houston County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>4795415</td>
      <td>POLYGON ((-85.71209 31.19727, -85.69231 31.210...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Barbour County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>50523213</td>
      <td>POLYGON ((-85.74803 31.61918, -85.73117 31.629...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sumter County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>24634880</td>
      <td>POLYGON ((-88.42145 32.30868, -88.34043 32.991...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Miller County, AR</td>
      <td>5</td>
      <td>...</td>
      <td>36848741</td>
      <td>POLYGON ((-94.04343 33.55158, -94.00037 33.564...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 14 columns</p>
</div></div></div>
</div>
<p>We’re now ready to merge our shapefile and net migration data together:</p>
<p><strong>Note</strong>: merging the DataFrame onto the GeoDataFrame ensures that the resulting file is also a GeoDataFrame–which will prove useful in our mapping code. (If we instead merged the GeoDataFrame onto our DataFrame, we’d end up with a DataFrame.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_counties_and_stats</span> <span class="o">=</span> <span class="n">gdf_counties</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">df_nm_county</span><span class="p">,</span> 
    <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;COUNTY&#39;</span><span class="p">])</span>
<span class="c1"># Because we did not specify an argument for the &#39;how&#39; parameter, </span>
<span class="c1"># the default &#39;inner&#39; option will be used. This option will </span>
<span class="c1"># exclude any counties that either (1) aren&#39;t present</span>
<span class="c1"># in the net migration stats table or (2) don&#39;t have a shape defined. </span>
<span class="c1"># This will prevent our mapping code from (1) showing counties with </span>
<span class="c1"># missing net migration data and (2) attempting</span>
<span class="c1"># to map a county that lacks a a corresponding outline.</span>
<span class="n">gdf_counties_and_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County/State</th>
      <th>STATE</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baldwin County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>9.675624</td>
      <td>96.660305</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Houston County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>1.472920</td>
      <td>58.842239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Barbour County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>-1.216854</td>
      <td>22.073791</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sumter County, AL</td>
      <td>1</td>
      <td>...</td>
      <td>-3.880428</td>
      <td>6.424936</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Miller County, AR</td>
      <td>5</td>
      <td>...</td>
      <td>0.523486</td>
      <td>46.024173</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 82 columns</p>
</div></div></div>
</div>
<p>Performing the same merge process for our state-level boundary and net migration DataFrames:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I&#39;d like to use &#39;State&#39; as the field name for state names,</span>
<span class="c1"># so I&#39;ll rename this field within both gdf_states and df_nm_state.</span>
<span class="c1"># I&#39;ll also rename a pre-existing &#39;STATE&#39; column within df_nm_state</span>
<span class="c1"># so that it won&#39;t get confused with the new &#39;State&#39; field.</span>
<span class="n">gdf_states</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NAME&#39;</span><span class="p">:</span><span class="s1">&#39;State&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df_nm_state</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;STNAME&#39;</span><span class="p">:</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> 
                              <span class="s1">&#39;STATE&#39;</span><span class="p">:</span><span class="s1">&#39;State_Code&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_states_and_stats</span> <span class="o">=</span> <span class="n">gdf_states</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">df_nm_state</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;State&#39;</span><span class="p">)</span>
<span class="n">gdf_states_and_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>STATENS</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>35</td>
      <td>00897535</td>
      <td>...</td>
      <td>-0.287505</td>
      <td>47.058824</td>
    </tr>
    <tr>
      <th>1</th>
      <td>46</td>
      <td>01785534</td>
      <td>...</td>
      <td>2.200485</td>
      <td>80.392157</td>
    </tr>
    <tr>
      <th>2</th>
      <td>06</td>
      <td>01779778</td>
      <td>...</td>
      <td>-3.029854</td>
      <td>5.882353</td>
    </tr>
    <tr>
      <th>3</th>
      <td>21</td>
      <td>01779786</td>
      <td>...</td>
      <td>0.501321</td>
      <td>58.823529</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01</td>
      <td>01779775</td>
      <td>...</td>
      <td>1.921424</td>
      <td>74.509804</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 79 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nm_state</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUMLEV</th>
      <th>REGION</th>
      <th>...</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>1.921424</td>
      <td>74.509804</td>
    </tr>
    <tr>
      <th>68</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-2.366596</td>
      <td>13.725490</td>
    </tr>
    <tr>
      <th>99</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>3.049036</td>
      <td>88.235294</td>
    </tr>
    <tr>
      <th>115</th>
      <td>40</td>
      <td>3</td>
      <td>...</td>
      <td>1.902381</td>
      <td>72.549020</td>
    </tr>
    <tr>
      <th>191</th>
      <td>40</td>
      <td>4</td>
      <td>...</td>
      <td>-3.029854</td>
      <td>5.882353</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 70 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="creating-a-choropleth-map-with-interactive-tooltips">
<h2>Creating a choropleth map with interactive tooltips<a class="headerlink" href="#creating-a-choropleth-map-with-interactive-tooltips" title="Link to this heading">#</a></h2>
<p>We can now create a choropleth map that shows net migration data by county. However, if we feed our entire gdf_counties_and_stats DataFrame into the mapping code, the resulting HTML file will be much larger than necessary, as it will include a number of columns that aren’t actually necessary in creating our map. Therefore, we’ll use a condensed version of gdf_counties_and_stats as a basis for this map instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Storing columns that we&#39;ll need to retain within</span>
<span class="c1"># our condensed state- and county-level DataFrames as variables:</span>
<span class="n">shape_col</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span>
<span class="n">county_boundary_name_col</span> <span class="o">=</span> <span class="s1">&#39;County/State&#39;</span>
<span class="n">state_boundary_name_col</span> <span class="o">=</span> <span class="s1">&#39;State&#39;</span>
<span class="n">data_col</span> <span class="o">=</span> <span class="n">total_nm_rate_col</span>

<span class="n">gdf_counties_and_stats_condensed</span> <span class="o">=</span> <span class="n">gdf_counties_and_stats</span><span class="p">[</span>
<span class="p">[</span><span class="n">shape_col</span><span class="p">,</span> <span class="n">county_boundary_name_col</span><span class="p">,</span> <span class="n">data_col</span><span class="p">,</span> <span class="n">percentile_col</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">gdf_counties_and_stats_condensed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>County/State</th>
      <th>2020-2023 Total Domestic Net Migration as % of 2020 Population</th>
      <th>2020-2023 Domestic Net Migration Percentile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>POLYGON ((-88.02858 30.22676, -87.96685 30.235...</td>
      <td>Baldwin County, AL</td>
      <td>9.675624</td>
      <td>96.660305</td>
    </tr>
    <tr>
      <th>1</th>
      <td>POLYGON ((-85.71209 31.19727, -85.69231 31.210...</td>
      <td>Houston County, AL</td>
      <td>1.472920</td>
      <td>58.842239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>POLYGON ((-85.74803 31.61918, -85.73117 31.629...</td>
      <td>Barbour County, AL</td>
      <td>-1.216854</td>
      <td>22.073791</td>
    </tr>
    <tr>
      <th>3</th>
      <td>POLYGON ((-88.42145 32.30868, -88.34043 32.991...</td>
      <td>Sumter County, AL</td>
      <td>-3.880428</td>
      <td>6.424936</td>
    </tr>
    <tr>
      <th>4</th>
      <td>POLYGON ((-94.04343 33.55158, -94.00037 33.564...</td>
      <td>Miller County, AR</td>
      <td>0.523486</td>
      <td>46.024173</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In order to create our choropleth map, we’ll need to determine which item to use as the key for creating our data. For our county-level map, we’ll want to use the ‘County/State’ column as the key, since it contains unique county names found in both the demographics and county outlines datasets.</p>
<p>However, if we attempt to pass ‘County/State’ to the <code class="docutils literal notranslate"><span class="pre">key_on</span></code> argument within our choropleth function, we’ll get the following error:</p>
<p><code class="docutils literal notranslate"><span class="pre">key_on</span> <span class="pre">'County/State'</span> <span class="pre">not</span> <span class="pre">found</span> <span class="pre">in</span> <span class="pre">GeoJSON.</span></code></p>
<p>That may strike you as strange: ‘County/State’ is definitely one of the columns in our GeoDataFrame. However, note that this code is referring to the <em>GeoJSON</em> version of this GeoDataFrame. The firstn 500 characters of this file appear as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_counties_and_stats_condensed</span><span class="o">.</span><span class="n">to_json</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">500</span><span class="p">]</span>
<span class="c1"># to_json() is listed at https://geopandas.org/en/stable/docs/reference/</span>
<span class="c1"># api/geopandas.GeoDataFrame.html#geopandas.GeoDataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;{&quot;type&quot;: &quot;FeatureCollection&quot;, &quot;features&quot;: [{&quot;id&quot;: &quot;0&quot;, &quot;type&quot;: &quot;Feature&quot;, &quot;properties&quot;: {&quot;County/State&quot;: &quot;Baldwin County, AL&quot;, &quot;2020-2023 Total Domestic Net Migration as % of 2020 Population&quot;: 9.675623899761831, &quot;2020-2023 Domestic Net Migration Percentile&quot;: 96.66030534351145}, &quot;geometry&quot;: {&quot;type&quot;: &quot;Polygon&quot;, &quot;coordinates&quot;: [[[-88.02858, 30.226763], [-87.966847, 30.235618], [-87.936041, 30.261469], [-87.893201, 30.239237], [-87.78775, 30.254244], [-87.768003, 30.262455], [-87.747171, 30.287768],&#39;
</pre></div>
</div>
</div>
</div>
<p>The ‘County/State’ column in this output is preceded by ‘Feature’ and ‘properties.’ Meanwhile, the choropleth example <a class="reference external" href="https://python-visualization.github.io/folium/latest/user_guide/geojson/choropleth.html">found in the Folium documentation</a> uses ‘<a class="reference external" href="http://feature.id">feature.id</a>’ as the key_on value. Here’s what the beginning of <a class="reference external" href="https://raw.githubusercontent.com/python-visualization/folium-example-data/main/us_states.json"><em>that</em> GeoJson file</a> looks like:</p>
<blockquote>
<div><p>{“type”:”FeatureCollection”,”features”:[
{“type”:”Feature”,”id”:”AL”,”properties”:{“name”:”Alabama”},”geometry”:{“type”:”Polygon”,”coordinates”:[[[-87.359296,35.00118],</p>
</div></blockquote>
<p>Note that ‘id’ is the column with state data (as it’s a state-level choropleth map), and that ‘properties’ comes <em>after</em> this value (whereas, in our GeoJson file, ‘properties’ comes <em>before</em> our county column). Therefore, we can make an educated guess that ‘feature.properties.County/State’ is the right value to pass to the key_on column, and thankfully this guess is correct!</p>
<p>(<a class="reference external" href="https://python-visualization.github.io/folium/latest/reference.html">Folium’s API reference</a> also hints at this solution by listing ‘feature.properties.statename’ as an example of a key_on value.</p>
<p>In my experience, figuring out what value to use for the ‘key_on’ argument is one of the trickier parts of using Folium’s Choropleth feature. If you’re having trouble with this step, my advice would be to always look at the GeoJson version of your GeoDataFrame and see what values precede it, then incorporate those values (‘feature’, ‘properties’, etc.) into your entry.</p>
<section id="creating-our-bin-ranges">
<h3>Creating our bin ranges<a class="headerlink" href="#creating-our-bin-ranges" title="Link to this heading">#</a></h3>
<p>By default, folium.Choropleth() will group regions into 6 colored bins; the ranges from these bins will stretch, in equal segments, from the lowest to the highest value. However, because some counties have very high or low net migration rates, this approach will cause our map to look relatively dull, since most counties will be in one of the middle bins.</p>
<p>Therefore, a better setup will be to base our bin ranges on percentiles, as this will result in a relatively equal number of counties’ appearing in each bin. (The bins will no longer be equally sized, but that’s not an issue in this case.) We can easily determine these bins’ cutoff points using pandas’ quantile() function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bin_thresholds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gdf_counties_and_stats_condensed</span><span class="p">[</span>
            <span class="n">total_nm_rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span>
<span class="c1"># See https://pandas.pydata.org/pandas-docs/stable/reference/api/</span>
<span class="c1"># pandas.DataFrame.quantile.html</span>
<span class="c1"># and https://numpy.org/doc/stable/reference/generated/numpy.linspace.html</span>
<span class="n">bin_thresholds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-26.57727350868145,
 -2.8124548451811697,
 -1.3842847014410304,
 -0.57942086570913,
 0.10509734758955473,
 0.803350933220706,
 1.5648502030833924,
 2.497913057064161,
 3.8660584451404807,
 5.966706571952004,
 25.59683979436641]
</pre></div>
</div>
</div>
</div>
<p>We can now finally create our choropleth map! (Note: I commented out the output of this and other Folium maps so that this notebook would be small enough to display correctly on GitHub. However, if you’re running this notebook locally on your computer, you can uncomment the ‘m’ at the end of the cell see what this map actually looks like.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The following code is based on: </span>
<span class="c1"># https://python-visualization.github.io/folium/latest/user_guide/</span>
<span class="c1"># geojson/choropleth.html</span>
<span class="c1"># Note: the &#39;RdYlGn&#39; (red-yellow-green) fill color </span>
<span class="c1"># argument derives from:</span>
<span class="c1"># https://colorbrewer2.org/#type=diverging&amp;scheme=RdYlGn&amp;n=3 ,</span>
<span class="c1"># a helpful interactive site referenced within the Folium API reference</span>
<span class="c1"># (https://python-visualization.github.io/folium/latest/</span>
<span class="c1"># reference.html#module-folium.features).</span>
<span class="c1"># This color palette isn&#39;t listed as one of the available palettes </span>
<span class="c1"># within the choropleth documentation, but it still works fine.</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">([</span><span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">95</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">folium</span><span class="o">.</span><span class="n">Choropleth</span><span class="p">(</span>
    <span class="n">geo_data</span><span class="o">=</span><span class="n">gdf_counties_and_stats_condensed</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">gdf_counties_and_stats_condensed</span><span class="p">,</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">bin_thresholds</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">county_boundary_name_col</span><span class="p">,</span> <span class="n">total_nm_rate_col</span><span class="p">],</span>
    <span class="n">key_on</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;feature.properties.</span><span class="si">{</span><span class="n">county_boundary_name_col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">fill_color</span> <span class="o">=</span> <span class="s1">&#39;RdYlGn&#39;</span><span class="p">,</span>
    <span class="n">fillOpacity</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;maps/basic_choropleth.html&#39;</span><span class="p">)</span> <span class="c1"># Useful for file size comparisons;</span>
<span class="c1"># an updated copy of this map that also contains tooltips will be shown</span>
<span class="c1"># shortly.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-in-tooltips">
<h3>Adding in tooltips<a class="headerlink" href="#adding-in-tooltips" title="Link to this heading">#</a></h3>
<p>We have a choropleth map in place, but it’s missing something very important: tooltips that will display both the name of a county and its net migration data when the user hovers over it. These tooltips aren’t present in the choropleth code by default, but <a class="reference external" href="https://python-visualization.github.io/folium/latest/user_guide/geojson/geojson_popup_and_tooltip.html">Folium’s documentation</a> demonstrates how to easily add them in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In the following code, &#39;fields&#39; lists the values that we wish</span>
<span class="c1"># to display within our tooltip, and &#39;aliases&#39; lists the titles for</span>
<span class="c1"># those values.</span>

<span class="n">tooltip</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">county_boundary_name_col</span><span class="p">,</span> <span class="n">total_nm_rate_col</span><span class="p">,</span> 
            <span class="n">percentile_col</span><span class="p">],</span>
    <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;County:&quot;</span><span class="p">,</span> 
             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s2"> Net Migration </span><span class="se">\</span>
<span class="s2">as % of </span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2"> Population:&quot;</span><span class="p">,</span> <span class="s1">&#39;Percentile&#39;</span><span class="p">],</span>
    <span class="n">localize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sticky</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        background-color: #FFFFFF;</span>
<span class="s2">        border: 1px;</span>
<span class="s2">        border-radius: 1px;</span>
<span class="s2">        box-shadow: 1px;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">max_width</span><span class="o">=</span><span class="mi">800</span>
<span class="p">)</span>
<span class="c1"># Based on:</span>
<span class="c1"># https://python-visualization.github.io/folium/latest/user_guide/</span>
<span class="c1"># geojson/geojson_popup_and_tooltip.html</span>

<span class="c1"># We&#39;ll now add these tooltips to our map by linking them</span>
<span class="c1"># to an invisible GeoJson object. (The county outlines were</span>
<span class="c1"># already present within the map as a result of the choropleth</span>
<span class="c1"># mapping code, so there&#39;s no need to add them again here.)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">gdf_counties_and_stats_condensed</span><span class="p">,</span>
    <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fillOpacity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1"># Also based on: </span>
<span class="c1"># https://python-visualization.github.io/folium/latest/user_guide/</span>
<span class="c1"># geojson/geojson_popup_and_tooltip.html</span>

<span class="c1"># We&#39;ll now go ahead and save the map:</span>

<span class="c1"># m.save(&#39;maps/choropleth_with_tooltips.html&#39;) # Useful for file size</span>
<span class="c1"># # comparisons</span>

<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;maps/net_migration_rate_county_</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="saving-a-screenshot-of-this-map">
<h3>Saving a screenshot of this map<a class="headerlink" href="#saving-a-screenshot-of-this-map" title="Link to this heading">#</a></h3>
<p>The Plotly charting library makes saving static copies of charts simple: we can just call write_image(). Folium doesn’t yet have this sort of functionality, but thankfully, it’s still possible to create static copies of its map files. We’ll just need to run some Selenium code that opens a web browser; navigates to our map; and then saves a screenshot of the map to a PNG file. The following code shows how to accomplish these steps.</p>
<p>(Note: I have found that Selenium may not work correctly when running a script <em>right after</em> installing it. Therefore, if you just installed Selenium and the following cell crashes, try exiting out of your Jupyter Notebook application; reopening it; and then rerunning this script.)</p>
<p>If your error message reads, in part, <code class="docutils literal notranslate"><span class="pre">NoSuchDriverException:</span> <span class="pre">Message:</span> <span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">obtain</span> <span class="pre">driver</span> <span class="pre">for</span> <span class="pre">chrome</span></code>, these instructions still apply. Selenium <em>should</em> be able to obtain the driver on its own–but you may just need to close and reopen your notebook before it can do so.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="c1"># Source: </span>
<span class="c1"># https://www.selenium.dev/documentation/webdriver/browsers/chrome/</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--window-size=3000,1688&#39;</span><span class="p">)</span> <span class="c1"># I found that this window</span>
<span class="c1"># size, along with a starting zoom of 6 within our mapping code,</span>
<span class="c1"># created a relatively detailed map of the contiguous 48 US states. </span>
<span class="c1"># If you&#39;d like to create an even more detailed map, consider setting </span>
<span class="c1"># your starting zoom to 7 and your window size to 6000,3375.</span>
<span class="n">options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--headless&#39;</span><span class="p">)</span> <span class="c1"># In my experience, this addition </span>
<span class="c1"># (which prevents the Selenium-driven browser from displaying on your </span>
<span class="c1"># computer) was necessary for allowing 4K screenshots to get saved</span>
<span class="c1"># as 3840x2160-pixel images. Without this line, the screenshots would </span>
<span class="c1"># get rendered with a resolution of 3814x1868 pixels.</span>
<span class="c1"># Source of the above two lines:  </span>
<span class="c1"># https://www.selenium.dev/documentation/webdriver/browsers/chrome/</span>
<span class="c1"># and</span>
<span class="c1"># https://github.com/GoogleChrome/chrome-launcher/blob/main/docs/</span>
<span class="c1"># chrome-flags-for-tools.md</span>
<span class="c1"># I learned about the necessity of using headless mode *somewhere* on </span>
<span class="c1"># StackOverflow. Many answers to this question regarding generating </span>
<span class="c1"># screenshots reference it as an important step, for instance:</span>
<span class="c1"># https://stackoverflow.com/questions/41721734/take-screenshot-of-</span>
<span class="c1"># full-page-with-selenium-python-with-chromedriver/57338909</span>


<span class="c1"># Launching our Selenium driver:</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span> 
<span class="c1"># Source: https://www.selenium.dev/documentation/webdriver/</span>
<span class="c1"># browsers/chrome/</span>

<span class="c1"># Navigating to our map:</span>
<span class="c1"># Note: I needed to precede the local path with &#39;file://&#39; as </span>
<span class="c1"># noted by GitHub user lukeis here: </span>
<span class="c1"># https://github.com/seleniumhq/selenium-google-code-issue-archive\</span>
<span class="c1"># /issues/3997#issuecomment-192014472</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s1">&#39;file://&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/maps/&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;net_migration_rate_county_</span><span class="se">\</span>
<span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span>
<span class="c1"># Source: https://www.selenium.dev/documentation/</span>
<span class="c1"># Adding in os.getcwd() + &#39;/&#39; converts our relative path </span>
<span class="c1"># (which, by itself wouldn&#39;t be compatible with Selenium)</span>
<span class="c1"># into an absolute path. (Note that &#39;/&#39; still works on Windows, at least</span>
<span class="c1"># in my experience.) </span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># Helps ensure that the browser has enough time to download</span>
<span class="c1"># map contents from the tile provider</span>
<span class="c1"># Taking our screenshot and then saving it as a PNG image:</span>

<span class="n">driver</span><span class="o">.</span><span class="n">get_screenshot_as_file</span><span class="p">(</span>
<span class="sa">f</span><span class="s1">&#39;map_screenshots/net_migration_rate_county_</span><span class="se">\</span>
<span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="c1"># Source: </span>
<span class="c1"># https://selenium-python.readthedocs.io/api.html#selenium.webdriver.</span>
<span class="c1">#remote.webdriver.WebDriver.get_screenshot_as_file</span>

<span class="c1"># Exiting out of our webdriver:</span>
<span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="c1"># Source: https://www.selenium.dev/documentation/</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s a look at the map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wadi</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;map_screenshots/net_migration_rate_county_</span><span class="se">\</span>
<span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
     <span class="n">generate_image</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display_type</span> <span class="o">=</span> <span class="n">display_type</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/a3242c7978f97a83550c5e0d01d631444bb8f97f3dcff0315401f49891b3adf4.png"><img alt="../_images/a3242c7978f97a83550c5e0d01d631444bb8f97f3dcff0315401f49891b3adf4.png" src="../_images/a3242c7978f97a83550c5e0d01d631444bb8f97f3dcff0315401f49891b3adf4.png" style="width: 720px;" /></a>
</div>
</div>
</section>
<section id="the-drawback-of-the-choropleth-mapping-approach-shown-above">
<h3>The drawback of the choropleth mapping approach shown above<a class="headerlink" href="#the-drawback-of-the-choropleth-mapping-approach-shown-above" title="Link to this heading">#</a></h3>
<p>We now have a choropleth map that shows additional information when the user hovers over a given county. That’s great! However, although this means of creating our map is relatively simple (and a good introduction to the use of Folium), it does have one significant flaw: it results in unnecessarily large file sizes.</p>
<p>On my computer, the first version of the map (with no tooltips) was around 6.23 MB in size. Once tooltips were added in, this map nearly doubled in size to 12.4 MB. This increase occurred because we added many items to the underlying HTML file twice, including our county boundaries.</p>
<p>Now, 12 MB isn’t that large of a file, but the larger your maps get, the harder (and potentially more expensive) it is to host them online, and the longer they’ll take to load. (For instance, Google Sites currently limits single embedded HTML files to 15 MB in size, so our 12-megabyte map is getting pretty close to that limit.) If you’re working with zip code-level data, this doubling in size could become a major issue and might even prevent the HTML version of your map from loading at all.</p>
<p>Therefore, I’ll now demonstrate a method that bypasses Folium’s Choropleth map class and instead allows the same set of borders to be used for tooltips and region colors. The map created with this method will be only 6.23 MB in size, yet it will still have the same interactive tooltips as the map we just created.</p>
</section>
</section>
<section id="creating-a-more-efficient-version-of-this-map">
<h2>Creating a more efficient version of this map<a class="headerlink" href="#creating-a-more-efficient-version-of-this-map" title="Link to this heading">#</a></h2>
<p>In order to create a choropleth map without relying on Folium’s Choropleth class, we’ll need to develop a color map that we can use to assign different colors to different net migration values. I borrowed from the folium.Choropleth() source code in order to determine how best to accomplish this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">color_range</span> <span class="o">=</span> <span class="n">color_brewer</span><span class="p">(</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># Based on folium.Choropleth() definition within</span>
<span class="c1"># https://github.com/python-visualization/folium/blob/main/folium/</span>
<span class="c1"># features.py</span>

<span class="c1"># Note: to reverse one of these color schemes, add &#39;_r&#39; </span>
<span class="c1"># to the end of the first argument (e.g. &#39;RdYlBu_r&#39;). </span>
<span class="c1"># Source: https://github.com/python-visualization/branca/blob/</span>
<span class="c1"># main/branca/utilities.py</span>

<span class="c1"># The following output shows the 10 colors (in hexadecimal format) </span>
<span class="c1"># that comprise this color range:</span>
<span class="n">color_range</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;#a50026&#39;,
 &#39;#d73027&#39;,
 &#39;#f46d43&#39;,
 &#39;#fdae61&#39;,
 &#39;#fee090&#39;,
 &#39;#e0f3f8&#39;,
 &#39;#abd9e9&#39;,
 &#39;#74add1&#39;,
 &#39;#4575b4&#39;,
 &#39;#313695&#39;]
</pre></div>
</div>
</div>
</div>
<section id="using-this-color-range-to-initialize-our-colormap">
<h3>Using this color range to initialize our colormap<a class="headerlink" href="#using-this-color-range-to-initialize-our-colormap" title="Link to this heading">#</a></h3>
<p>Note that passing our quantile-based bins to the index argument allows the colormap to reference those bins when determining which colors to assign to which values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepped_cm</span> <span class="o">=</span> <span class="n">StepColormap</span><span class="p">(</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">color_range</span><span class="p">,</span> 
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">bin_thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">bin_thresholds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">bin_thresholds</span><span class="p">)</span>
<span class="c1"># Based on the self.color_scale initialization within </span>
<span class="c1"># Folium&#39;s Choropleth() source code (available at</span>
<span class="c1"># https://github.com/python-visualization/folium/blob/main/folium/</span>
<span class="c1"># features.py)</span>

<span class="n">stepped_cm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg height="40" width="450"><line x1="0" y1="15" x2="0" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="1" y1="15" x2="1" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="2" y1="15" x2="2" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="3" y1="15" x2="3" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="4" y1="15" x2="4" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="5" y1="15" x2="5" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="6" y1="15" x2="6" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="7" y1="15" x2="7" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="8" y1="15" x2="8" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="9" y1="15" x2="9" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="10" y1="15" x2="10" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="11" y1="15" x2="11" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="12" y1="15" x2="12" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="13" y1="15" x2="13" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="14" y1="15" x2="14" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="15" y1="15" x2="15" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="16" y1="15" x2="16" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="17" y1="15" x2="17" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="18" y1="15" x2="18" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="19" y1="15" x2="19" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="20" y1="15" x2="20" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="21" y1="15" x2="21" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="22" y1="15" x2="22" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="23" y1="15" x2="23" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="24" y1="15" x2="24" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="25" y1="15" x2="25" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="26" y1="15" x2="26" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="27" y1="15" x2="27" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="28" y1="15" x2="28" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="29" y1="15" x2="29" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="30" y1="15" x2="30" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="31" y1="15" x2="31" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="32" y1="15" x2="32" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="33" y1="15" x2="33" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="34" y1="15" x2="34" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="35" y1="15" x2="35" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="36" y1="15" x2="36" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="37" y1="15" x2="37" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="38" y1="15" x2="38" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="39" y1="15" x2="39" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="40" y1="15" x2="40" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="41" y1="15" x2="41" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="42" y1="15" x2="42" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="43" y1="15" x2="43" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="44" y1="15" x2="44" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="45" y1="15" x2="45" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="46" y1="15" x2="46" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="47" y1="15" x2="47" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="48" y1="15" x2="48" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="49" y1="15" x2="49" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="50" y1="15" x2="50" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="51" y1="15" x2="51" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="52" y1="15" x2="52" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="53" y1="15" x2="53" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="54" y1="15" x2="54" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="55" y1="15" x2="55" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="56" y1="15" x2="56" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="57" y1="15" x2="57" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="58" y1="15" x2="58" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="59" y1="15" x2="59" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="60" y1="15" x2="60" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="61" y1="15" x2="61" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="62" y1="15" x2="62" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="63" y1="15" x2="63" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="64" y1="15" x2="64" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="65" y1="15" x2="65" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="66" y1="15" x2="66" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="67" y1="15" x2="67" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="68" y1="15" x2="68" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="69" y1="15" x2="69" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="70" y1="15" x2="70" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="71" y1="15" x2="71" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="72" y1="15" x2="72" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="73" y1="15" x2="73" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="74" y1="15" x2="74" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="75" y1="15" x2="75" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="76" y1="15" x2="76" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="77" y1="15" x2="77" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="78" y1="15" x2="78" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="79" y1="15" x2="79" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="80" y1="15" x2="80" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="81" y1="15" x2="81" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="82" y1="15" x2="82" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="83" y1="15" x2="83" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="84" y1="15" x2="84" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="85" y1="15" x2="85" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="86" y1="15" x2="86" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="87" y1="15" x2="87" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="88" y1="15" x2="88" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="89" y1="15" x2="89" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="90" y1="15" x2="90" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="91" y1="15" x2="91" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="92" y1="15" x2="92" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="93" y1="15" x2="93" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="94" y1="15" x2="94" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="95" y1="15" x2="95" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="96" y1="15" x2="96" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="97" y1="15" x2="97" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="98" y1="15" x2="98" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="99" y1="15" x2="99" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="100" y1="15" x2="100" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="101" y1="15" x2="101" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="102" y1="15" x2="102" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="103" y1="15" x2="103" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="104" y1="15" x2="104" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="105" y1="15" x2="105" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="106" y1="15" x2="106" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="107" y1="15" x2="107" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="108" y1="15" x2="108" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="109" y1="15" x2="109" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="110" y1="15" x2="110" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="111" y1="15" x2="111" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="112" y1="15" x2="112" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="113" y1="15" x2="113" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="114" y1="15" x2="114" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="115" y1="15" x2="115" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="116" y1="15" x2="116" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="117" y1="15" x2="117" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="118" y1="15" x2="118" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="119" y1="15" x2="119" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="120" y1="15" x2="120" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="121" y1="15" x2="121" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="122" y1="15" x2="122" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="123" y1="15" x2="123" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="124" y1="15" x2="124" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="125" y1="15" x2="125" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="126" y1="15" x2="126" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="127" y1="15" x2="127" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="128" y1="15" x2="128" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="129" y1="15" x2="129" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="130" y1="15" x2="130" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="131" y1="15" x2="131" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="132" y1="15" x2="132" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="133" y1="15" x2="133" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="134" y1="15" x2="134" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="135" y1="15" x2="135" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="136" y1="15" x2="136" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="137" y1="15" x2="137" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="138" y1="15" x2="138" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="139" y1="15" x2="139" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="140" y1="15" x2="140" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="141" y1="15" x2="141" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="142" y1="15" x2="142" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="143" y1="15" x2="143" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="144" y1="15" x2="144" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="145" y1="15" x2="145" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="146" y1="15" x2="146" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="147" y1="15" x2="147" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="148" y1="15" x2="148" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="149" y1="15" x2="149" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="150" y1="15" x2="150" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="151" y1="15" x2="151" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="152" y1="15" x2="152" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="153" y1="15" x2="153" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="154" y1="15" x2="154" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="155" y1="15" x2="155" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="156" y1="15" x2="156" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="157" y1="15" x2="157" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="158" y1="15" x2="158" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="159" y1="15" x2="159" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="160" y1="15" x2="160" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="161" y1="15" x2="161" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="162" y1="15" x2="162" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="163" y1="15" x2="163" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="164" y1="15" x2="164" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="165" y1="15" x2="165" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="166" y1="15" x2="166" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="167" y1="15" x2="167" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="168" y1="15" x2="168" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="169" y1="15" x2="169" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="170" y1="15" x2="170" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="171" y1="15" x2="171" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="172" y1="15" x2="172" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="173" y1="15" x2="173" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="174" y1="15" x2="174" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="175" y1="15" x2="175" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="176" y1="15" x2="176" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="177" y1="15" x2="177" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="178" y1="15" x2="178" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="179" y1="15" x2="179" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="180" y1="15" x2="180" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="181" y1="15" x2="181" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="182" y1="15" x2="182" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="183" y1="15" x2="183" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="184" y1="15" x2="184" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="185" y1="15" x2="185" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="186" y1="15" x2="186" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="187" y1="15" x2="187" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="188" y1="15" x2="188" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="189" y1="15" x2="189" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="190" y1="15" x2="190" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="191" y1="15" x2="191" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="192" y1="15" x2="192" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="193" y1="15" x2="193" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="194" y1="15" x2="194" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="195" y1="15" x2="195" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="196" y1="15" x2="196" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="197" y1="15" x2="197" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="198" y1="15" x2="198" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="199" y1="15" x2="199" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="200" y1="15" x2="200" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="201" y1="15" x2="201" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="202" y1="15" x2="202" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="203" y1="15" x2="203" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="204" y1="15" x2="204" y2="27" style="stroke:#a50026ff;stroke-width:2;" /><line x1="205" y1="15" x2="205" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="206" y1="15" x2="206" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="207" y1="15" x2="207" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="208" y1="15" x2="208" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="209" y1="15" x2="209" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="210" y1="15" x2="210" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="211" y1="15" x2="211" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="212" y1="15" x2="212" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="213" y1="15" x2="213" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="214" y1="15" x2="214" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="215" y1="15" x2="215" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="216" y1="15" x2="216" y2="27" style="stroke:#d73027ff;stroke-width:2;" /><line x1="217" y1="15" x2="217" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="218" y1="15" x2="218" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="219" y1="15" x2="219" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="220" y1="15" x2="220" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="221" y1="15" x2="221" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="222" y1="15" x2="222" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="223" y1="15" x2="223" y2="27" style="stroke:#f46d43ff;stroke-width:2;" /><line x1="224" y1="15" x2="224" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="225" y1="15" x2="225" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="226" y1="15" x2="226" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="227" y1="15" x2="227" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="228" y1="15" x2="228" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="229" y1="15" x2="229" y2="27" style="stroke:#fdae61ff;stroke-width:2;" /><line x1="230" y1="15" x2="230" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="231" y1="15" x2="231" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="232" y1="15" x2="232" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="233" y1="15" x2="233" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="234" y1="15" x2="234" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="235" y1="15" x2="235" y2="27" style="stroke:#fee090ff;stroke-width:2;" /><line x1="236" y1="15" x2="236" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="237" y1="15" x2="237" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="238" y1="15" x2="238" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="239" y1="15" x2="239" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="240" y1="15" x2="240" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="241" y1="15" x2="241" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="242" y1="15" x2="242" y2="27" style="stroke:#e0f3f8ff;stroke-width:2;" /><line x1="243" y1="15" x2="243" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="244" y1="15" x2="244" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="245" y1="15" x2="245" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="246" y1="15" x2="246" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="247" y1="15" x2="247" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="248" y1="15" x2="248" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="249" y1="15" x2="249" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="250" y1="15" x2="250" y2="27" style="stroke:#abd9e9ff;stroke-width:2;" /><line x1="251" y1="15" x2="251" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="252" y1="15" x2="252" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="253" y1="15" x2="253" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="254" y1="15" x2="254" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="255" y1="15" x2="255" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="256" y1="15" x2="256" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="257" y1="15" x2="257" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="258" y1="15" x2="258" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="259" y1="15" x2="259" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="260" y1="15" x2="260" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="261" y1="15" x2="261" y2="27" style="stroke:#74add1ff;stroke-width:2;" /><line x1="262" y1="15" x2="262" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="263" y1="15" x2="263" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="264" y1="15" x2="264" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="265" y1="15" x2="265" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="266" y1="15" x2="266" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="267" y1="15" x2="267" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="268" y1="15" x2="268" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="269" y1="15" x2="269" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="270" y1="15" x2="270" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="271" y1="15" x2="271" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="272" y1="15" x2="272" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="273" y1="15" x2="273" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="274" y1="15" x2="274" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="275" y1="15" x2="275" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="276" y1="15" x2="276" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="277" y1="15" x2="277" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="278" y1="15" x2="278" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="279" y1="15" x2="279" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="280" y1="15" x2="280" y2="27" style="stroke:#4575b4ff;stroke-width:2;" /><line x1="281" y1="15" x2="281" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="282" y1="15" x2="282" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="283" y1="15" x2="283" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="284" y1="15" x2="284" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="285" y1="15" x2="285" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="286" y1="15" x2="286" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="287" y1="15" x2="287" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="288" y1="15" x2="288" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="289" y1="15" x2="289" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="290" y1="15" x2="290" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="291" y1="15" x2="291" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="292" y1="15" x2="292" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="293" y1="15" x2="293" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="294" y1="15" x2="294" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="295" y1="15" x2="295" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="296" y1="15" x2="296" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="297" y1="15" x2="297" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="298" y1="15" x2="298" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="299" y1="15" x2="299" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="300" y1="15" x2="300" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="301" y1="15" x2="301" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="302" y1="15" x2="302" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="303" y1="15" x2="303" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="304" y1="15" x2="304" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="305" y1="15" x2="305" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="306" y1="15" x2="306" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="307" y1="15" x2="307" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="308" y1="15" x2="308" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="309" y1="15" x2="309" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="310" y1="15" x2="310" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="311" y1="15" x2="311" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="312" y1="15" x2="312" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="313" y1="15" x2="313" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="314" y1="15" x2="314" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="315" y1="15" x2="315" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="316" y1="15" x2="316" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="317" y1="15" x2="317" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="318" y1="15" x2="318" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="319" y1="15" x2="319" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="320" y1="15" x2="320" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="321" y1="15" x2="321" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="322" y1="15" x2="322" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="323" y1="15" x2="323" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="324" y1="15" x2="324" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="325" y1="15" x2="325" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="326" y1="15" x2="326" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="327" y1="15" x2="327" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="328" y1="15" x2="328" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="329" y1="15" x2="329" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="330" y1="15" x2="330" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="331" y1="15" x2="331" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="332" y1="15" x2="332" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="333" y1="15" x2="333" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="334" y1="15" x2="334" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="335" y1="15" x2="335" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="336" y1="15" x2="336" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="337" y1="15" x2="337" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="338" y1="15" x2="338" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="339" y1="15" x2="339" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="340" y1="15" x2="340" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="341" y1="15" x2="341" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="342" y1="15" x2="342" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="343" y1="15" x2="343" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="344" y1="15" x2="344" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="345" y1="15" x2="345" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="346" y1="15" x2="346" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="347" y1="15" x2="347" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="348" y1="15" x2="348" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="349" y1="15" x2="349" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="350" y1="15" x2="350" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="351" y1="15" x2="351" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="352" y1="15" x2="352" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="353" y1="15" x2="353" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="354" y1="15" x2="354" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="355" y1="15" x2="355" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="356" y1="15" x2="356" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="357" y1="15" x2="357" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="358" y1="15" x2="358" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="359" y1="15" x2="359" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="360" y1="15" x2="360" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="361" y1="15" x2="361" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="362" y1="15" x2="362" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="363" y1="15" x2="363" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="364" y1="15" x2="364" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="365" y1="15" x2="365" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="366" y1="15" x2="366" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="367" y1="15" x2="367" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="368" y1="15" x2="368" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="369" y1="15" x2="369" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="370" y1="15" x2="370" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="371" y1="15" x2="371" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="372" y1="15" x2="372" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="373" y1="15" x2="373" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="374" y1="15" x2="374" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="375" y1="15" x2="375" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="376" y1="15" x2="376" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="377" y1="15" x2="377" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="378" y1="15" x2="378" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="379" y1="15" x2="379" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="380" y1="15" x2="380" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="381" y1="15" x2="381" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="382" y1="15" x2="382" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="383" y1="15" x2="383" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="384" y1="15" x2="384" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="385" y1="15" x2="385" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="386" y1="15" x2="386" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="387" y1="15" x2="387" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="388" y1="15" x2="388" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="389" y1="15" x2="389" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="390" y1="15" x2="390" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="391" y1="15" x2="391" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="392" y1="15" x2="392" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="393" y1="15" x2="393" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="394" y1="15" x2="394" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="395" y1="15" x2="395" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="396" y1="15" x2="396" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="397" y1="15" x2="397" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="398" y1="15" x2="398" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="399" y1="15" x2="399" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="400" y1="15" x2="400" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="401" y1="15" x2="401" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="402" y1="15" x2="402" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="403" y1="15" x2="403" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="404" y1="15" x2="404" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="405" y1="15" x2="405" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="406" y1="15" x2="406" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="407" y1="15" x2="407" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="408" y1="15" x2="408" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="409" y1="15" x2="409" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="410" y1="15" x2="410" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="411" y1="15" x2="411" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="412" y1="15" x2="412" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="413" y1="15" x2="413" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="414" y1="15" x2="414" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="415" y1="15" x2="415" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="416" y1="15" x2="416" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="417" y1="15" x2="417" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="418" y1="15" x2="418" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="419" y1="15" x2="419" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="420" y1="15" x2="420" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="421" y1="15" x2="421" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="422" y1="15" x2="422" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="423" y1="15" x2="423" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="424" y1="15" x2="424" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="425" y1="15" x2="425" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="426" y1="15" x2="426" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="427" y1="15" x2="427" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="428" y1="15" x2="428" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="429" y1="15" x2="429" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="430" y1="15" x2="430" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="431" y1="15" x2="431" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="432" y1="15" x2="432" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="433" y1="15" x2="433" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="434" y1="15" x2="434" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="435" y1="15" x2="435" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="436" y1="15" x2="436" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="437" y1="15" x2="437" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="438" y1="15" x2="438" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="439" y1="15" x2="439" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="440" y1="15" x2="440" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="441" y1="15" x2="441" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="442" y1="15" x2="442" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="443" y1="15" x2="443" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="444" y1="15" x2="444" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="445" y1="15" x2="445" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="446" y1="15" x2="446" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="447" y1="15" x2="447" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="448" y1="15" x2="448" y2="27" style="stroke:#313695ff;stroke-width:2;" /><line x1="449" y1="15" x2="449" y2="27" style="stroke:#313695ff;stroke-width:2;" /><text x="0" y="38" style="text-anchor:start; font-size:11px; font:Arial; fill:black">-26.57727350868145</text><text x="75" y="38"; style="text-anchor:middle; font-size:11px; font:Arial; fill:black">-17.9</text><text x="150" y="38"; style="text-anchor:middle; font-size:11px; font:Arial; fill:black">-9.2</text><text x="225" y="38"; style="text-anchor:middle; font-size:11px; font:Arial; fill:black">-0.5</text><text x="300" y="38"; style="text-anchor:middle; font-size:11px; font:Arial; fill:black">8.2</text><text x="375" y="38"; style="text-anchor:middle; font-size:11px; font:Arial; fill:black">16.9</text><text x="450" y="38" style="text-anchor:end; font-size:11px; font:Arial; fill:black">25.59683979436641</text><text x="0" y="12" style="font-size:11px; font:Arial; fill:black"></text></svg></div></div>
</div>
<p>We can apply this colormap to determine the colors corresponding to a given net migration value as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepped_cm</span><span class="p">(</span><span class="n">gdf_counties_and_stats_condensed</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">total_nm_rate_col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;#313695ff&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-our-tooltips-and-choropleth-map-simultaneously-via-folium-geojson">
<h3>Creating our tooltips and choropleth map simultaneously via folium.GeoJson<a class="headerlink" href="#creating-our-tooltips-and-choropleth-map-simultaneously-via-folium-geojson" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Much of this cell is based on the sample code found at </span>
<span class="c1"># https://python-visualization.github.io/folium/latest/user_guide/</span>
<span class="c1"># geojson/geojson_popup_and_tooltip.html# </span>
<span class="c1"># and https://python-visualization.github.io/folium/latest/</span>
<span class="c1"># user_guide/geojson/geojson.html .</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">95</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">tooltip</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">county_boundary_name_col</span><span class="p">,</span> <span class="n">total_nm_rate_col</span><span class="p">,</span>
           <span class="n">percentile_col</span><span class="p">],</span>
    <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;County:&quot;</span><span class="p">,</span> 
             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s2"> Net Migration </span><span class="se">\</span>
<span class="s2">as % of </span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2"> Population:&quot;</span><span class="p">,</span> <span class="s1">&#39;Percentile&#39;</span><span class="p">],</span>
    <span class="n">localize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sticky</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        background-color: #FFFFFF;</span>
<span class="s2">        border: 1px;</span>
<span class="s2">        border-radius: 1px;</span>
<span class="s2">        box-shadow: 1px;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">max_width</span><span class="o">=</span><span class="mi">800</span>
<span class="p">)</span>

<span class="c1"># The following code will both assign colors from our StepColorMap</span>
<span class="c1"># to each county *and* add in our tooltips. This approach allows both</span>
<span class="c1"># our colors and tooltips to reference the same set of county outlines,</span>
<span class="c1"># thus making for a more efficient map.</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">GeoJson</span><span class="p">(</span>
    <span class="n">gdf_counties_and_stats_condensed</span><span class="p">,</span>
    <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fillColor&quot;</span><span class="p">:</span> <span class="n">stepped_cm</span><span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">total_nm_rate_col</span><span class="p">]),</span>
        <span class="s2">&quot;fillOpacity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;black&quot;</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1"># The Folium.GeoJSON overview at</span>
<span class="c1"># https://python-visualization.github.io/folium/latest/user_guide/</span>
<span class="c1"># geojson/geojson.html</span>
<span class="c1"># contributed to this code as well.</span>
<span class="c1"># Note that we need to add [&quot;properties&quot;] in between x and </span>
<span class="c1"># [total_nm_rate_col], likely because gdf_counties_and_stats_condensed</span>
<span class="c1"># is being interpreted as a GeoJSON object. I based this off of the</span>
<span class="c1"># &quot;if &quot;e&quot; in feature[&quot;properties&quot;][&quot;name&quot;].lower()&quot; line within</span>
<span class="c1"># the above link.</span>

<span class="c1"># Adding our StepColorMap to the output as well:</span>
<span class="n">stepped_cm</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;maps/net_migration_rate_county_</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">)</span>

<span class="c1"># A view of this map will be shown later within this notebook.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="converting-this-second-mapping-approach-into-a-function">
<h3>Converting this second mapping approach into a function<a class="headerlink" href="#converting-this-second-mapping-approach-into-a-function" title="Link to this heading">#</a></h3>
<p>In order to make this code easier to apply to other datasets, I converted it into a function (<code class="docutils literal notranslate"><span class="pre">cptt()</span></code>) by replacing hardcoded values with variables. (This is often how I create functions: I start with a working example that uses built-in values, then make that example more flexible by substituting variable names for those values.) <strong>This function is located within folium_choropleth_map_functions.py; I placed it there so that it could be more easily called by different notebooks.</strong></p>
<p>I also added code to this function that allows a selected column’s data to be displayed directly atop each boundary. This code works much better for state-level data (which we’ll graph later) than county-level data, since the latter shapes are too small to accommodate these labels at a nationwide zoom level.</p>
</section>
<section id="calling-this-function-separately-for-html-and-png-maps">
<h3>Calling this function separately for HTML and PNG maps<a class="headerlink" href="#calling-this-function-separately-for-html-and-png-maps" title="Link to this heading">#</a></h3>
<p>I’ve found that, if I try to use the same zoom level for both an HTML file and a screenshot, one of the maps will end up showing too much or too little zoom. Therefore, it can be useful to call <code class="docutils literal notranslate"><span class="pre">cptt()</span></code> twice–once to create a PNG version of a map, and again to create an HTML version. <code class="docutils literal notranslate"><span class="pre">create_map_and_screenshot()</span></code>, also available within folium_choropleth_map_functions.py, makes it easier to perform these two function calls.</p>
<p>Ideally, we could eliminate the need to call <code class="docutils literal notranslate"><span class="pre">cptt()</span></code> twice by updating the zoom level of the map within our code; this would allow us to save an HTML copy of the map for interactive viewing, then update its zoom to better accommodate a screenshot. Even better, we could try using Selenium to adjust the zoom, which would eliminate the need to create two separate HTML maps.</p>
<p>I tried out some code for both of these options, but neither worked successfully. Therefore, I’m sticking for now to the slower, yet reliable approach shown within <code class="docutils literal notranslate"><span class="pre">create_map_and_screenshot()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing the two functions described above:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">folium_choropleth_map_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">cptt</span><span class="p">,</span> <span class="n">create_map_and_screenshot</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="applying-these-functions-to-create-html-and-png-versions-of-our-net-migration-by-county-map-with-optimized-zoom-levels">
<h3>Applying these functions to create HTML and PNG versions of our net migration by county map with optimized zoom levels<a class="headerlink" href="#applying-these-functions-to-create-html-and-png-versions-of-our-net-migration-by-county-map-with-optimized-zoom-levels" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining data_col_alias outside of the function call to make the latter</span>
<span class="c1"># a bit more readable:</span>

<span class="n">data_col_alias</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s2"> Net Migration </span><span class="se">\</span>
<span class="s2">as % of </span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s2"> Population:&quot;</span>

<span class="n">map_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;net_migration_rate_county_</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="c1"># Because cptt() automatically condenses the GeoDataFrame to include</span>
<span class="c1"># only those columns necessary for creating the map and tooltips,</span>
<span class="c1"># we can pass the original gdf_counties_and_stats GeoDataFrame as our </span>
<span class="c1"># gdf argument.</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">create_map_and_screenshot</span><span class="p">(</span>
    <span class="n">starting_lat</span> <span class="o">=</span> <span class="mi">38</span><span class="p">,</span> <span class="n">starting_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mi">95</span><span class="p">,</span> 
    <span class="n">html_zoom_start</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">screenshot_zoom_start</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf_counties_and_stats</span><span class="p">,</span> 
    <span class="n">data_col</span> <span class="o">=</span> <span class="n">total_nm_rate_col</span><span class="p">,</span> 
    <span class="n">boundary_name_col</span> <span class="o">=</span> <span class="n">county_boundary_name_col</span><span class="p">,</span>
    <span class="n">data_col_alias</span> <span class="o">=</span> <span class="n">data_col_alias</span><span class="p">,</span> <span class="n">boundary_name_alias</span> <span class="o">=</span> <span class="s1">&#39;County:&#39;</span><span class="p">,</span>
    <span class="n">tooltip_variable_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">percentile_col</span><span class="p">],</span> 
         <span class="n">tooltip_alias_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Percentile:&#39;</span><span class="p">],</span>
    <span class="n">bin_type</span> <span class="o">=</span> <span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="n">bin_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color_scheme</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
        <span class="n">map_filename</span> <span class="o">=</span> <span class="n">map_filename</span><span class="p">,</span>
        <span class="n">html_map_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/maps&#39;</span><span class="p">,</span>
        <span class="n">png_map_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/map_screenshots&#39;</span><span class="p">)</span>
<span class="c1"># Note the use of os.getcwd() to convert the relative paths to the &#39;maps&#39;</span>
<span class="c1"># and &#39;map_screenshots&#39; folders into full paths.</span>

<span class="n">wadi</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;map_screenshots/net_migration_rate_county_</span><span class="se">\</span>
<span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
     <span class="n">generate_image</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display_type</span> <span class="o">=</span> <span class="n">display_type</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generating screenshot.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Removed HTML copy of map.
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/5b1d4369178f6ca27b3c53e9ccfbc95f60f3da7bf068c8c38fd55a332133a194.png"><img alt="../_images/5b1d4369178f6ca27b3c53e9ccfbc95f60f3da7bf068c8c38fd55a332133a194.png" src="../_images/5b1d4369178f6ca27b3c53e9ccfbc95f60f3da7bf068c8c38fd55a332133a194.png" style="width: 720px;" /></a>
</div>
</div>
</section>
<section id="calling-create-map-and-screenshot-again-to-create-state-level-net-migration-maps-in-html-and-png-form">
<h3>Calling create_map_and_screenshot() again to create state-level net migration maps in HTML and PNG form<a class="headerlink" href="#calling-create-map-and-screenshot-again-to-create-state-level-net-migration-maps-in-html-and-png-form" title="Link to this heading">#</a></h3>
<p>For demonstration purposes, I set the ‘tiles’ argument to None in order to create a clean and simple map without any underlying tile data. Since there won’t be anything to show under the choropleth boundaries, we can set choropleth_opacity to 1, resulting in a more vivid map.</p>
<p>I also chose to add net migration rates as boundary labels. In order to make the labels a bit easier to read, I switched the color scheme from RdYlBu to RdYlGn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll use the same data_col_alias that we created for our county-level</span>
<span class="c1"># map</span>

<span class="n">map_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;net_migration_rate_state_</span><span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">create_map_and_screenshot</span><span class="p">(</span>
    <span class="n">starting_lat</span> <span class="o">=</span> <span class="mi">38</span><span class="p">,</span> <span class="n">starting_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mi">95</span><span class="p">,</span> 
    <span class="n">html_zoom_start</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">screenshot_zoom_start</span><span class="o">=</span> <span class="mi">6</span><span class="p">,</span> 
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf_states_and_stats</span><span class="p">,</span> 
    <span class="n">data_col</span> <span class="o">=</span> <span class="n">total_nm_rate_col</span><span class="p">,</span> 
    <span class="n">boundary_name_col</span> <span class="o">=</span> <span class="n">state_boundary_name_col</span><span class="p">,</span>
    <span class="n">data_col_alias</span> <span class="o">=</span> <span class="n">data_col_alias</span><span class="p">,</span> <span class="n">boundary_name_alias</span> <span class="o">=</span> <span class="s1">&#39;State:&#39;</span><span class="p">,</span>
    <span class="n">tooltip_variable_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">percentile_col</span><span class="p">],</span> 
         <span class="n">tooltip_alias_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Percentile:&#39;</span><span class="p">],</span>
    <span class="n">bin_type</span> <span class="o">=</span> <span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="n">bin_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color_scheme</span> <span class="o">=</span> <span class="s1">&#39;RdYlGn&#39;</span><span class="p">,</span>
        <span class="n">map_filename</span> <span class="o">=</span> <span class="n">map_filename</span><span class="p">,</span> <span class="n">tiles</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">choropleth_opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">add_boundary_labels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
        <span class="n">boundary_label_col</span> <span class="o">=</span> <span class="n">total_nm_rate_col</span><span class="p">,</span>
        <span class="n">round_boundary_labels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">boundary_label_round_val</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">html_map_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/maps&#39;</span><span class="p">,</span>
        <span class="n">png_map_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/map_screenshots&#39;</span><span class="p">)</span>

<span class="n">wadi</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;map_screenshots/net_migration_rate_state_</span><span class="se">\</span>
<span class="si">{</span><span class="n">first_nm_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">last_nm_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
     <span class="n">generate_image</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">display_type</span> <span class="o">=</span> <span class="n">display_type</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generating screenshot.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Removed HTML copy of map.
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/4c1415403ea56549bfc2d2581312d1cbc91d2ebe71f5c60d1470b0de57a30e3a.png"><img alt="../_images/4c1415403ea56549bfc2d2581312d1cbc91d2ebe71f5c60d1470b0de57a30e3a.png" src="../_images/4c1415403ea56549bfc2d2581312d1cbc91d2ebe71f5c60d1470b0de57a30e3a.png" style="width: 720px;" /></a>
</div>
</div>
<p>That’s it for this notebook! I would have liked to keep this section simpler, but building choropleth maps can get a little complex, especially if you wish to bypass folium.Chorolpeth(). I hope you’ll find both this notebook and the functions shown within folium_choropleth_map_functions.py useful for your own mapping projects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">program_end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">run_time</span> <span class="o">=</span> <span class="n">program_end_time</span> <span class="o">-</span> <span class="n">program_start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished running program in </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">run_time</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished running program in 22.06 seconds.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Mapping"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../Book_Specific_Materials/plotly_choropleth_map_functions_py_nb.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">plotly_choropleth_map_functions.py</p>
      </div>
    </a>
    <a class="right-next"
       href="../Book_Specific_Materials/folium_choropleth_map_functions_py_nb.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">folium_choropleth_map_functions.py</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-our-net-migration-data">Gathering our net migration data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-total-net-migration-across-all-years-within-the-dataset">Calculating total net migration across all years within the dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-percentile-data-to-each-dataset">Adding percentile data to each dataset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-county-and-state-boundaries">Importing county and state boundaries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-shape-and-demographic-data-tables-together">Merging shape and demographic data tables together</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-choropleth-map-with-interactive-tooltips">Creating a choropleth map with interactive tooltips</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-bin-ranges">Creating our bin ranges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-in-tooltips">Adding in tooltips</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-a-screenshot-of-this-map">Saving a screenshot of this map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-drawback-of-the-choropleth-mapping-approach-shown-above">The drawback of the choropleth mapping approach shown above</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-more-efficient-version-of-this-map">Creating a more efficient version of this map</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-this-color-range-to-initialize-our-colormap">Using this color range to initialize our colormap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-tooltips-and-choropleth-map-simultaneously-via-folium-geojson">Creating our tooltips and choropleth map simultaneously via folium.GeoJson</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-this-second-mapping-approach-into-a-function">Converting this second mapping approach into a function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calling-this-function-separately-for-html-and-png-maps">Calling this function separately for HTML and PNG maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-these-functions-to-create-html-and-png-versions-of-our-net-migration-by-county-map-with-optimized-zoom-levels">Applying these functions to create HTML and PNG versions of our net migration by county map with optimized zoom levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calling-create-map-and-screenshot-again-to-create-state-level-net-migration-maps-in-html-and-png-form">Calling create_map_and_screenshot() again to create state-level net migration maps in HTML and PNG form</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kenneth Burchfiel
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>